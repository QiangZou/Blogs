# SWidget

- friend struct FCurveSequence;
- friend class FWidgetProxy;
- friend class FSlateInvalidationRoot;
- friend class FSlateWindowElementList;
- friend class SWindow;
- friend struct FSlateCachedElementList;
- friend struct FInvalidatedWidgetDrawer;

- void Construct();
  - 根据初始参数构造一个 SWidget。
  - void SWidgetConstruct();
- int32 Paint() const;绘制
- virtual void Tick();
- 焦点相关
  - virtual FReply OnFocusReceived();焦点在该组件触发
  - virtual void OnFocusLost();焦点失去
  - virtual void OnFocusChanging();焦点改变
  - virtual bool SupportsKeyboardFocus() const;支持键盘焦点
  - virtual bool HasKeyboardFocus() const;是否具有键盘焦点
  - TOptional<> HasUserFocus(int32 UserIndex) const;指定用户是否关注该组件
  - TOptional<> HasAnyUserFocus() const;任何用户关注该组件
  - bool HasUserFocusedDescendants(int32 UserIndex) const;指定用户是否关注该组件或子组件
  - bool HasFocusedDescendants() const;;指定用户是否关注该组件或子组件
  - bool HasAnyUserFocusOrFocusedDescendants() const;任何用户关注该组件或子组件
  - uint8 bCanSupportFocus : 1;是否可以支持键盘焦点
  - virtual TOptional<> OnQueryShowFocus() const;渲染焦点画笔
  - virtual const FSlateBrush* GetFocusBrush() 用于绘制焦点的画笔，如果不需要绘制焦点，则为 nullptr
- 键盘相关
  - virtual FReply OnKeyChar();具有键盘焦点时输入字符后调用
  - virtual FReply OnPreviewKeyDown();具有焦点时按下某个键后调用
  - virtual FReply OnKeyDown();键盘按下
  - virtual FReply OnKeyUp();键盘抬起
  - virtual FReply OnAnalogValueChanged();当支持模拟的按钮上的模拟值发生变化时调用
- 鼠标相关
  - uint8 bIsHovered : 1;鼠标是否悬停

  - virtual bool IsHovered() const
  - FNoReplyPointerEventHandler MouseEnterHandler;鼠标按下事件
  - FSimpleNoReplyPointerEventHandler MouseLeaveHandler;鼠标离开事件
  - virtual FReply OnMouseButtonDown();鼠标按下
  - virtual FReply OnPreviewMouseButtonDown();
  - virtual FReply OnMouseButtonUp();鼠标抬起
  - virtual FReply OnMouseMove();鼠标在组件中移动
  - virtual void OnMouseEnter();鼠标移动进入
  - virtual void OnMouseLeave();鼠标移动离开
  - virtual FReply OnMouseWheel();鼠标滚轮旋转
  - virtual TOptional<> OnMapCursor() const;系统要求鼠标下的每个小部件提供一个光标
  - virtual FReply OnMouseButtonDoubleClick();双击鼠标按钮时调用
  - void SetOnMouseButtonDown(FPointerEventHandler EventHandler);设置鼠标按下
  - void SetOnMouseButtonUp(FPointerEventHandler EventHandler);设置鼠标抬起
  - void SetOnMouseMove(FPointerEventHandler EventHandler);设置鼠标移动
  - void SetOnMouseDoubleClick(FPointerEventHandler EventHandler);设置鼠标双击
  - void SetOnMouseLeave(FSimpleNoReplyPointerEventHandler EventHandler);设置鼠标移动离开
  - virtual void OnMouseCaptureLost();当此小部件捕获鼠标时调用，但由于某种原因该捕获已被撤销
  - bool HasMouseCapture() const;检查这个小部件是否是当前的鼠标捕获器
  - bool HasMouseCaptureByUser() const;检查此小部件是否从提供的用户处捕获鼠标。
  - virtual TSharedPtr<> TranslateMouseCoordinateForCustomHitTestChild()测试子对象翻译鼠标坐标
  - TAttribute<> Cursor; 光标
  - void SetCursor( const TAttribute<>& InCursor );
  - virtual FCursorReply OnCursorQuery() const;鼠标下的每个小部件提供一个光标
- 可视化
  - virtual bool OnVisualizeTooltip();可视化工具提示
  - virtual TSharedPtr<FPopupLayer> OnVisualizePopup();可视化弹窗
- 拖动
  - virtual FReply OnDragDetected();开始拖动检测
  - virtual void OnDragEnter();拖动进入组件
  - virtual void OnDragLeave();拖动离开组件
  - virtual FReply OnDragOver();拖动结束
  - virtual FReply OnDrop();当用户将东西放到小部件上时调用； 终止拖放
- 触摸板
  - virtual FReply OnTouchGesture();触控板执行手势
  - virtual FReply OnTouchStarted();触控板开始执行手势
  - virtual FReply OnTouchMoved();触控板手势移动
  - virtual FReply OnTouchEnded();触控板手势结束
  - virtual FReply OnTouchForceChanged();触摸板触摸力改变时调用
  - virtual FReply OnTouchFirstMove();在 TouchStarted 之后触摸板触摸第一次移动时调用
- 可见性
  - TAttribute< > Visibility;此小部件是否可见、隐藏或折叠
  - FORCEINLINE EVisibility GetVisibility()
  - virtual void SetVisibility();
  - static const TAttribute<>& AccessWidgetVisibilityAttribute()访问其他小部件的可见性属性
  - void UpdateFastPathVisibility();快速更新可见性
  - uint8 bInvisibleDueToParentOrSelfVisibility : 1;是否继承由于父级或自己的可见性
- virtual FReply OnMotionDetected();检测到运动时调用（控制器或设备）
- virtual FPopupMethodReply OnQueryPopupMethod() const;弹出窗口
- virtual void OnFinishedPointerInput();完成指针输入
- virtual void OnFinishedKeyInput();完成键盘输入
- virtual FNavigationReply OnNavigation();请求导航时调用 例如 左操纵杆、方向键可以生成导航事件
- virtual EWindowZone::Type GetWindowZoneOverride() const;获取鼠标所在的窗口区域
- FSlateRect CalculateCullingAndClippingRules() const;计算绘制此小部件时是否需要发生任何剪辑状态更改
- virtual float GetRelativeLayoutScale() const; 子组件相对于这个组件的比例是多少。
- virtual bool IsInteractable() const这个小部件是否具有交互性？ 默认为假
- virtual void OnToolTipClosing();当从这个小部件显示的工具提示被关闭时调用
- virtual bool IsDirectlyHovered() const;如果直接悬停此小部件，则为真
- 可访问
  - virtual TSharedRef<> CreateAccessibleWidget();创建可访问组件
  - FText GetAccessibleText() const;获取尝试访问此小部件时应向用户报告的文本
  - FText GetAccessibleSummary() const;遍历所有子小部件并连接它们的结果。
  - bool IsAccessible() const;是否认为此小部件可访问
  - EAccessibleBehavior GetAccessibleBehavior() const;获取小部件的可访问的行为。
  - bool CanChildrenBeAccessible() const;检查此小部件是否允许其子部件可访问
  - void SetAccessibleBehavior();设置一个新的可访问行为
  - void SetCanChildrenBeAccessible(bool InCanChildrenBeAccessible);设置是否允许访问儿童
  - virtual TOptional<> GetDefaultAccessibleText() const;分配一个默认值
  - uint8 bCanChildrenBeAccessible : 1;围绕此小部件如何向平台的可访问性 API 公开的所有变量
  - EAccessibleBehavior AccessibleBehavior;
  - EAccessibleBehavior AccessibleSummaryBehavior;
- 无效
  - void Invalidate(EInvalidateWidgetReason InvalidateReason); 使无效 下次绘制刷新
  - void InvalidatePrepass();
  - void InvalidateChildRemovedFromTree(SWidget& Child);使子对象无效 SWidgetSwitcher使用
  - FORCEINLINE bool Advanced_InvalidateVolatility()重新计算是否无效
  - uint8 bVolatilityAlwaysInvalidatesPrepass : 1;
    - 如果此小部件在不稳定时应始终使 prepass 步骤无效
    - FORCEINLINE bool ShouldInvalidatePrepassDueToVolatility() 
- 渲染
  - 透明
    - float RenderOpacity;渲染透明
    - FORCEINLINE float GetRenderOpacity() const
    - FORCEINLINE void SetRenderOpacity(float InRenderOpacity)
  - 变换
    - TAttribute<  > RenderTransform;
    - FORCEINLINE const TOptional<>& GetRenderTransform() const
    - FORCEINLINE void SetRenderTransform()
    - FORCEINLINE TOptional<> GetRenderTransformWithRespectToFlowDirection() const
  - 变换中心
    - TAttribute< FVector2D > RenderTransformPivot;
    - FORCEINLINE FVector2D GetRenderTransformPivot() const
    - FORCEINLINE void SetRenderTransformPivot(TAttribute<> InTransformPivot)
    - FORCEINLINE FVector2D GetRenderTransformPivotWithRespectToFlowDirection() const
- 裁剪
  - EWidgetClipping Clipping;
  - FORCEINLINE void SetClipping(EWidgetClipping InClipping)
  - FORCEINLINE EWidgetClipping GetClipping() const
  - uint8 bClippingProxy : 1;是否裁剪委托
  - virtual void OnClippingChanged();
  - const TOptional<>& GetCurrentClippingState() const {  }
- 剔除界限范围
  - FMargin CullingBoundsExtension;
  - FORCEINLINE void SetCullingBoundsExtension(const FMargin& InCullingBoundsExtension)
  - FORCEINLINE FMargin GetCullingBoundsExtension() const
- void SetDebugInfo();由 Slate 用于设置有关此小部件的运行时调试信息
- virtual FString ToString() const;小部件的字符串表示
- virtual FSlateColor GetForegroundColor() const;此小部件设置的前景色；
- virtual bool Advanced_IsWindow() const { return false; }这个小部件是 SWindow 的衍生物吗
- virtual bool Advanced_IsInvalidationRoot() const { return false; }

- virtual bool CustomPrepass(float LayoutScaleMultiplier) { return false; }自定义准备
- SWidget();
- virtual ~SWidget();
- 子对象相关
  - uint8 bCanHaveChildren : 1;
    - 是否可以用子对象
  - void ArrangeChildren() const; 排序子组件
  - virtual void OnArrangeChildren() const = 0;
  - virtual FChildren* GetChildren() = 0;获取子对象
    - virtual FChildren* GetAllChildren() { return GetChildren(); }
  - bool AssignIndicesToChildren();为孩子分配索引
  - bool IsChildWidgetCulled() const;测试是否应剔除排列的小部件
  - FORCEINLINE bool IsChildWidgetCulled() const { return false; }测试是否应剔除排列的小部件
  - bool FindChildGeometries() const;查找子组件几何尺寸
  - void FindChildGeometries_Helper() const;查找子组件几何尺寸
  - FGeometry FindChildGeometry() const;查找子组件几何数据
  - static int32 FindChildUnderMouse();鼠标当前悬停的孩子的索引
  - static int32 FindChildUnderPosition();指定位置下子节点的索引
- bool ShouldBeEnabled( bool InParentEnabled ) const确定是否应启用此小部件
- virtual bool ComputeVolatility() const
- float GetPrepassLayoutScaleMultiplier() const { return PrepassLayoutScaleMultiplier.Get(1.0f); }
- bool SetAttribute()
- uint8 bHasCustomPrepass : 1;
- uint8 bHasRelativeLayoutScale : 1;
- EFlowDirection ComputeFlowDirection() const
- TOptional<float> PrepassLayoutScaleMultiplier;
- TAttribute< bool > EnabledState;
  - void SetEnabled(const TAttribute<bool>& InEnabledState)
  - FORCEINLINE bool IsEnabled() const
- FName TypeOfWidget;
  - FString GetTypeAsString() const;
  - FName GetType() const;
- FName CreatedInLocation;
  - 创建此小部件的完整文件路径
  - virtual FString GetReadableLocation() const;
  - FName GetCreatedInLocation() const;
- FName Tag;
  - 标签
  - FORCEINLINE void SetTag(FName InTag)
  - virtual FName GetTag() const;
- TArray<TSharedRef<>> MetaData;与此组件关联的元数据
  - TSharedPtr<> GetMetaData() const
  - TArray<> GetAllMetaData() const
  - void AddMetadata(const TSharedRef<>& AddMe)
  - void AddMetadataInternal(const TSharedRef<>& AddMe);

- void UpdateFastPathVolatility(bool bParentVolatile);
- uint32 Debug_GetLastPaintFrame() const { return LastPaintFrame; }
- void Debug_UpdateLastPaintFrame() { LastPaintFrame = GFrameNumber; }
- virtual int32 OnPaint() const = 0;
- uint8 bToolTipForceFieldEnabled : 1;
  - 是否工具提示组件强制占用排版
  - bool HasToolTipForceField() const
  - void EnableToolTipForceField(const bool bEnableForceField);
- uint8 bForceVolatile : 1;
  - 是否强制volatile状态 每帧刷新
  - FORCEINLINE void ForceVolatile(bool bForce)
- uint8 bCachedVolatile : 1;
  - 是否缓存了volatile 防止每帧刷新
  - FORCEINLINE bool IsVolatile() const { return bCachedVolatile; }
  - FORCEINLINE void CacheVolatility()
- uint8 bInheritedVolatility : 1;
  - 是否继承易变属性
  - FORCEINLINE bool IsVolatileIndirectly() const { return bInheritedVolatility; }
- uint8 bNeedsPrepass : 1;
  - 需要准备更新大小
  - bool NeedsPrepass() const { return bNeedsPrepass; }
- EFlowDirectionPreference FlowDirectionPreference;
  - 流向偏好
  - void SetFlowDirectionPreference(EFlowDirectionPreference InFlowDirectionPreference)
  - EFlowDirectionPreference GetFlowDirectionPreference() const { return FlowDirectionPreference; }
- EWidgetUpdateFlags UpdateFlags; 此小部件下一帧需要的不同更新
  - void SetCanTick(bool bInCanTick) { }
  - bool GetCanTick() const { }
  - bool HasAnyUpdateFlags(EWidgetUpdateFlags FlagsToCheck) const
  - void AddUpdateFlags(EWidgetUpdateFlags FlagsToAdd)
  - void RemoveUpdateFlags(EWidgetUpdateFlags FlagsToRemove)
  - void UpdateWidgetProxy(int32 NewLayerId, FSlateCachedElementsHandle& CacheHandle);
  - mutable FWidgetProxyHandle FastPathProxyHandle;
    - const FWidgetProxyHandle GetProxyHandle() const { return FastPathProxyHandle; }
- uint32 LastPaintFrame = 0;
- mutable FSlateWidgetPersistentState PersistentState; 组件持续状态
  - const FSlateWidgetPersistentState& GetPersistentState() const { return PersistentState; }
  - const FGeometry& GetCachedGeometry() const;
  - const FGeometry& GetTickSpaceGeometry() const;
  - const FGeometry& GetPaintSpaceGeometry() const;
- TOptional<> DesiredSize;
  - FVector2D GetDesiredSize() const;上次调用 CacheDesiredSize() 时计算的大小
  - void SetDesiredSize(const FVector2D& InDesiredSize)
  - virtual void CacheDesiredSize(float InLayoutScaleMultiplier);
  - virtual FVector2D ComputeDesiredSize(float LayoutScaleMultiplier) const = 0;
  - uint8 bNeedsDesiredSize : 1;
  - mutable uint8 bUpdatingDesiredSize : 1;
  - void SlatePrepass();预计算Slate大小 从子组件开始算起
    - void SlatePrepass(float InLayoutScaleMultiplier);
    - void Prepass_Internal(float LayoutScaleMultiplier);
- TArray<> ActiveTimers;
  - TSharedRef<> RegisterActiveTimer();注册激活时间
  - void UnRegisterActiveTimer();取消注册激活时间
  - bool HasActiveTimers() const { return ActiveTimers.Num() > 0; }
  - void ExecuteActiveTimers();迭代小部件上的活动计时器句柄，并在它们的间隔已过时执行它们
- TSharedPtr<> ToolTip;
  - virtual TSharedPtr<> GetToolTip();
  - void SetToolTipText(const TAttribute<>& ToolTipText);
  - void SetToolTipText( const FText& InToolTipText );
  - void SetToolTip( const TSharedPtr<>& InToolTip );
- TWeakPtr<> ParentWidgetPtr;
  - 父组件 如果它为空，则这是一个根小部件或不在小部件树中

  - void AssignParentWidget(TSharedPtr<> InParent);分配父小部件
  - bool ConditionallyDetatchParentWidget(SWidget* InExpectedParent);分离父组件
  - virtual bool ValidatePathToChild(SWidget* InChild) { return true; }验证子路径
  - FORCEINLINE bool IsParentValid() const { return ParentWidgetPtr.IsValid(); }//父组件是否有效
  - FORCEINLINE TSharedPtr<> GetParentWidget() const {  }获取父组件
  - FORCEINLINE TSharedPtr<> Advanced_GetPaintParentWidget()高级获取绘制父组件
- TArray<> PointerEvents;
  - 指针事件
  - const FPointerEventHandler* GetPointerEvent(const FName EventName) const;
  - void SetPointerEvent(const FName EventName, FPointerEventHandler& InEvent);
- uint64 UniqueIdentifier;
  - 唯一标识符
  - uint64 GetId() const { return UniqueIdentifier; }
- mutable TStatId StatID;
  - 此对象的 Stat id，如果没人获取，则为 0
  - FORCEINLINE TStatId GetStatID() const
  - void CreateStatID() const;
  - mutable PROFILER_CHAR* StatIDStringStorage;